# 🔌 Redmine 敏感資料防護插件 - 功能規格書

## 📋 概述

本插件用於防止使用者在 Redmine 系統中儲存、傳輸或散布機敏資訊，提供自動偵測、即時阻擋、操作稽核等功能。本規格書已於 2.0.3 版本進行了更新，反映了最新的程式碼修正和改進。

---

## 🎯 系統需求

### 支援的 Redmine 版本
- **Redmine 6.0.6** ✅ (主要支援版本)
- **Redmine 6.0.x** ✅ (相容)
- **Redmine 5.x** ⚠️ (部分功能可能受限)

### 系統環境需求
- **Ruby 版本**：3.0+ (推薦 3.3.9)
- **Rails 版本**：6.0+ (推薦 7.2.2.1)
- **資料庫**：MySQL 8.0+, PostgreSQL 12+, SQLite 3.35+
- **記憶體**：最少 4GB RAM
- **儲存空間**：至少 2GB 可用空間

### 版本相容性
- **v2.0.3**：最新穩定版本，支援完整的錯誤處理和安全性改進
- **v2.0.x**：支援 Redmine 6.0.6 (Rails 7.2.2.1, Ruby 3.3.9)
- **v1.0.x**：舊版本，僅支援 Redmine 4.1.1

---

## 🧩 核心功能

### 1. 敏感資料偵測
- **身分證號碼**：台灣身分證號格式偵測
- **信用卡號碼**：信用卡號格式偵測
- **API 金鑰**：API Key、Secret、Token 偵測
- **帳號密碼**：使用者帳號密碼組合偵測
- **手機號碼**：台灣手機號碼格式偵測
- **Email 地址**：Email 格式偵測
- **IP 位址**：內部和外部 IP 位址偵測

### 2. Office 文件掃描
- 支援 `.docx`, `.xlsx`, `.pptx`, `.pdf` 檔案格式
- 自動掃描檔案內容中的敏感資訊
- 檔案大小限制和效能優化

### 3. 即時阻擋與警告
- 高風險內容自動阻擋提交
- 中低風險內容顯示警告訊息
- 支援覆蓋權限機制
- 白名單例外處理

### 4. 操作稽核記錄
- 完整的操作日誌記錄
- 分級保留策略（高風險7年、一般3年）
- 自動清理過期日誌
- 統計報表和匯出功能

### 5. 審核管理
- 敏感資料審核介面
- 批量審核功能
- 審核統計和報表

### 6. 效能監控
- 系統效能監控
- 處理時間統計
- 資源使用分析

### 7. 錯誤處理與日誌
- 統一的錯誤處理機制
- 詳細的日誌記錄
- 錯誤分類和統計

---

## 🔐 敏感資訊類型

### 技術憑證類型
- 帳號密碼組合
- API Key / Secret / Token
- 資料庫連線字串
- 內部/外部 IP 位址
- 組態檔設定

### 個人識別資訊（PII）
- 身分證號碼
- 手機號碼
- Email 地址
- 信用卡號碼
- 個人地址

---

## ⚙️ 配置選項

### 基本設定
- **啟用插件**：開啟/關閉插件功能
- **檔案掃描**：啟用 Office 文件內容掃描
- **檔案大小限制**：設定最大檔案大小（預設 50MB）

### 風險等級設定
- **高風險偵測**：身分證號、信用卡號、API Key
- **中風險偵測**：手機號碼、Email、內部 IP
- **低風險偵測**：外部 IP、一般密碼

### 處理策略
- **阻擋**：直接阻止提交
- **警告**：顯示警告但允許提交
- **記錄**：僅記錄不阻擋

### 錯誤處理設定
- **錯誤日誌記錄**：啟用詳細錯誤日誌
- **錯誤通知**：配置錯誤通知機制
- **錯誤分類**：錯誤類型分類和統計

---

## 🏗️ 架構設計

### 核心組件

#### 1. 偵測引擎
- **SimpleSensitiveDataDetector**：簡化的敏感資料偵測引擎
- **檔案掃描器**：檔案內容掃描和處理
- **快取管理器**：偵測結果快取和效能優化

#### 2. 日誌管理
- **SensitiveOperationLog**：敏感操作日誌模型
- **日誌清理服務**：自動清理過期日誌
- **統計計算**：日誌統計和分析

#### 3. 審核系統
- **審核控制器**：審核流程管理
- **權限檢查**：用戶權限驗證
- **批量操作**：批量審核功能

#### 4. 效能監控
- **效能監控器**：系統效能監控
- **資源使用統計**：CPU、記憶體、磁碟使用統計
- **處理時間分析**：操作處理時間統計

### 資料流程

1. **內容輸入** → 2. **敏感資料偵測** → 3. **風險評估** → 4. **處理決策** → 5. **日誌記錄**

---

## 🔒 安全性設計

### 資料保護
- **敏感資料遮蔽**：自動遮蔽敏感資料顯示
- **存取控制**：基於權限的資料存取控制
- **審計追蹤**：完整的操作審計記錄

### 錯誤處理
- **統一錯誤處理**：標準化的錯誤處理機制
- **錯誤分類**：錯誤類型分類和統計
- **錯誤日誌**：詳細的錯誤日誌記錄

### 權限管理
- **角色權限**：基於角色的權限控制
- **功能權限**：細粒度的功能權限控制
- **資料權限**：資料存取權限控制

---

## 📊 效能指標

### 處理效能
- **偵測速度**：< 100ms per MB
- **檔案掃描**：支援最大 50MB 檔案
- **並發處理**：支援多用戶並發操作

### 系統資源
- **記憶體使用**：< 512MB RAM
- **CPU 使用**：< 10% 平均使用率
- **磁碟空間**：< 1GB 日誌儲存空間

### 可用性
- **系統可用性**：> 99.9%
- **錯誤率**：< 0.1%
- **恢復時間**：< 5 分鐘

---

## 🔄 版本控制

### 版本策略
- **語義化版本**：遵循 Semantic Versioning 規範
- **向後相容性**：保持 API 向後相容
- **棄用通知**：提前 6 個月通知棄用功能

### 更新流程
1. **開發** → 2. **測試** → 3. **審核** → 4. **發布** → 5. **部署**

---

## 📞 支援與維護

### 技術支援
- **GitHub Issues**：問題回報和追蹤
- **文檔更新**：定期文檔更新和維護
- **社群支援**：社群討論和支援

### 維護計劃
- **定期更新**：每月功能更新和安全修復
- **版本支援**：主要版本支援 2 年
- **安全修復**：安全問題優先處理

---

**規格書版本：** 2.0.3  
**最後更新：** 2025-01-27
